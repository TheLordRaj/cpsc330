
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Lecture 8: Hyperparameter Optimization and Optimization Bias &#8212; CPSC 330 Applied Machine Learning</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lecture 9: Classification Metrics" href="09_classification-metrics.html" />
    <link rel="prev" title="Lecture 7: Linear Models" href="07_linear-models.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/UBC-CS-logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">CPSC 330 Applied Machine Learning</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Things you should know
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/README.html">
   CPSC 330 Documents
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Lectures
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_intro.html">
   Lecture 1: Course Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_decision-trees.html">
   Lecture 2: Terminology, Baselines, Decision Trees
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_ml-fundamentals.html">
   Lecture 3: Machine Learning Fundamentals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_kNNs-SVM-RBF.html">
   Lecture 4:
   <span class="math notranslate nohighlight">
    \(k\)
   </span>
   -Nearest Neighbours and SVM RBFs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_preprocessing-pipelines.html">
   Lecture 5: Preprocessing and
   <code class="docutils literal notranslate">
    <span class="pre">
     sklearn
    </span>
   </code>
   pipelines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_column-transformer-text-feats.html">
   Lecture 6:
   <code class="docutils literal notranslate">
    <span class="pre">
     sklearn
    </span>
   </code>
   <code class="docutils literal notranslate">
    <span class="pre">
     ColumnTransformer
    </span>
   </code>
   and Text Features
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_linear-models.html">
   Lecture 7: Linear Models
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Lecture 8: Hyperparameter Optimization and Optimization Bias
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_classification-metrics.html">
   Lecture 9: Classification Metrics
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Attribution
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../attribution.html">
   Attributions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../LICENSE.html">
   LICENSE
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Varada Kolhatkar, CPSC 330 2022-23<br>Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/UBC-CS/cpsc330/master?urlpath=tree/lectures/08_hyperparameter-optimization.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/lectures/08_hyperparameter-optimization.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports-announcements-and-lo">
   Imports, Announcements, and LO
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#imports">
     Imports
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#announcements">
     Announcements
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#learning-outcomes">
     Learning outcomes
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#hyperparameter-optimization-motivation">
   Hyperparameter optimization motivation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#motivation">
     Motivation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hyperparameters-the-problem">
     Hyperparameters: the problem
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-ways-to-pick-hyperparameters">
     Some ways to pick hyperparameters:
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#manual-hyperparameter-optimization">
       Manual hyperparameter optimization
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#automated-hyperparameter-optimization">
     Automated hyperparameter optimization
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exhaustive-grid-search-sklearn-model-selection-gridsearchcv">
   Exhaustive grid search:
   <code class="docutils literal notranslate">
    <span class="pre">
     sklearn.model_selection.GridSearchCV
    </span>
   </code>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#n-jobs-1">
     <code class="docutils literal notranslate">
      <span class="pre">
       n_jobs=-1
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-syntax">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       __
      </span>
     </code>
     syntax
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#range-of-c">
     Range of
     <code class="docutils literal notranslate">
      <span class="pre">
       C
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualizing-the-parameter-grid-as-a-heatmap">
     Visualizing the parameter grid as a heatmap
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bad-range-for-hyperparameters">
     Bad range for hyperparameters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#different-range-for-hyperparameters-yields-better-results">
     Different range for hyperparameters yields better results!
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#problems-with-exhaustive-grid-search">
     Problems with exhaustive grid search
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#randomized-hyperparameter-search">
   Randomized hyperparameter search
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#n-iter">
     <code class="docutils literal notranslate">
      <span class="pre">
       n_iter
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-passing-probability-distributions-to-random-search">
     (Optional) Passing probability distributions to random search
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#advantages-of-randomizedsearchcv">
     Advantages of
     <code class="docutils literal notranslate">
      <span class="pre">
       RandomizedSearchCV
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Advantages of
     <code class="docutils literal notranslate">
      <span class="pre">
       RandomizedSearchCV
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#searching-for-optimal-parameters-with-successive-halving">
     Searching for optimal parameters with successive halving¶
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#optional-fancier-methods">
   (Optional) Fancier methods
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#questions-for-you">
   ❓❓ Questions for you
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iclicker-exercise-8-1">
     (iClicker) Exercise 8.1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#questions-for-class-discussion-hyperparameter-optimization">
     Questions for class discussion (hyperparameter optimization)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#optimization-bias-overfitting-of-the-validation-set">
   Optimization bias/Overfitting of the validation set
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overfitting-of-the-validation-error">
     Overfitting of the validation error
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optimization-bias-of-parameter-learning">
     Optimization bias of parameter learning
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optimization-bias-of-hyper-parameter-learning">
     Optimization bias of hyper-parameter learning
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-example-1-optimization-bias">
     (Optional) Example 1: Optimization bias
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-example-2-optimization-bias">
     (Optional) Example 2: Optimization bias
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optimization-bias-on-the-spotify-dataset">
     Optimization bias on the Spotify dataset
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overfitting-of-the-validation-data">
     Overfitting of the validation data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#why-do-we-need-a-test-set">
     Why do we need a test set?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#when-test-score-is-much-lower-than-cv-score">
     When test score is much lower than CV score
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#large-datasets-solve-many-of-these-problems">
     Large datasets solve many of these problems
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   ❓❓ Questions for you
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#would-you-trust-the-model">
     Would you trust the model?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Would you trust the model?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     Would you trust the model?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#final-comments-and-summary">
   Final comments and summary
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     Automated hyperparameter optimization
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#optional-readings-and-resources">
   Optional readings and resources
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Lecture 8: Hyperparameter Optimization and Optimization Bias</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports-announcements-and-lo">
   Imports, Announcements, and LO
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#imports">
     Imports
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#announcements">
     Announcements
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#learning-outcomes">
     Learning outcomes
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#hyperparameter-optimization-motivation">
   Hyperparameter optimization motivation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#motivation">
     Motivation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hyperparameters-the-problem">
     Hyperparameters: the problem
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-ways-to-pick-hyperparameters">
     Some ways to pick hyperparameters:
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#manual-hyperparameter-optimization">
       Manual hyperparameter optimization
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#automated-hyperparameter-optimization">
     Automated hyperparameter optimization
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exhaustive-grid-search-sklearn-model-selection-gridsearchcv">
   Exhaustive grid search:
   <code class="docutils literal notranslate">
    <span class="pre">
     sklearn.model_selection.GridSearchCV
    </span>
   </code>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#n-jobs-1">
     <code class="docutils literal notranslate">
      <span class="pre">
       n_jobs=-1
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-syntax">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       __
      </span>
     </code>
     syntax
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#range-of-c">
     Range of
     <code class="docutils literal notranslate">
      <span class="pre">
       C
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualizing-the-parameter-grid-as-a-heatmap">
     Visualizing the parameter grid as a heatmap
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bad-range-for-hyperparameters">
     Bad range for hyperparameters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#different-range-for-hyperparameters-yields-better-results">
     Different range for hyperparameters yields better results!
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#problems-with-exhaustive-grid-search">
     Problems with exhaustive grid search
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#randomized-hyperparameter-search">
   Randomized hyperparameter search
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#n-iter">
     <code class="docutils literal notranslate">
      <span class="pre">
       n_iter
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-passing-probability-distributions-to-random-search">
     (Optional) Passing probability distributions to random search
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#advantages-of-randomizedsearchcv">
     Advantages of
     <code class="docutils literal notranslate">
      <span class="pre">
       RandomizedSearchCV
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Advantages of
     <code class="docutils literal notranslate">
      <span class="pre">
       RandomizedSearchCV
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#searching-for-optimal-parameters-with-successive-halving">
     Searching for optimal parameters with successive halving¶
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#optional-fancier-methods">
   (Optional) Fancier methods
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#questions-for-you">
   ❓❓ Questions for you
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iclicker-exercise-8-1">
     (iClicker) Exercise 8.1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#questions-for-class-discussion-hyperparameter-optimization">
     Questions for class discussion (hyperparameter optimization)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#optimization-bias-overfitting-of-the-validation-set">
   Optimization bias/Overfitting of the validation set
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overfitting-of-the-validation-error">
     Overfitting of the validation error
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optimization-bias-of-parameter-learning">
     Optimization bias of parameter learning
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optimization-bias-of-hyper-parameter-learning">
     Optimization bias of hyper-parameter learning
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-example-1-optimization-bias">
     (Optional) Example 1: Optimization bias
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-example-2-optimization-bias">
     (Optional) Example 2: Optimization bias
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optimization-bias-on-the-spotify-dataset">
     Optimization bias on the Spotify dataset
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overfitting-of-the-validation-data">
     Overfitting of the validation data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#why-do-we-need-a-test-set">
     Why do we need a test set?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#when-test-score-is-much-lower-than-cv-score">
     When test score is much lower than CV score
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#large-datasets-solve-many-of-these-problems">
     Large datasets solve many of these problems
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   ❓❓ Questions for you
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#would-you-trust-the-model">
     Would you trust the model?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Would you trust the model?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     Would you trust the model?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#final-comments-and-summary">
   Final comments and summary
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     Automated hyperparameter optimization
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#optional-readings-and-resources">
   Optional readings and resources
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <p><img alt="" src="../_images/330-banner.png" /></p>
<section class="tex2jax_ignore mathjax_ignore" id="lecture-8-hyperparameter-optimization-and-optimization-bias">
<h1>Lecture 8: Hyperparameter Optimization and Optimization Bias<a class="headerlink" href="#lecture-8-hyperparameter-optimization-and-optimization-bias" title="Permalink to this headline">#</a></h1>
<p>UBC 2022-23</p>
<p>Instructor: Varada Kolhatkar</p>
<section id="imports-announcements-and-lo">
<h2>Imports, Announcements, and LO<a class="headerlink" href="#imports-announcements-and-lo" title="Permalink to this headline">#</a></h2>
<section id="imports">
<h3>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;code/.&quot;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">mglearn</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">plotting_functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">cross_validate</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="o">*</span>


<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</section>
<section id="announcements">
<h3>Announcements<a class="headerlink" href="#announcements" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>HW3 was due last night.</p></li>
<li><p>HW4 will be released by tonight. (It will be due next Tuesday.)</p></li>
<li><p>HW2 grades are released.</p></li>
<li><p>Apologies that no one showed up to the Zoom OH yesterday. I’ll make sure this doesn’t happen again.</p></li>
</ul>
</section>
<section id="learning-outcomes">
<h3>Learning outcomes<a class="headerlink" href="#learning-outcomes" title="Permalink to this headline">#</a></h3>
<p>From this lecture, you will be able to</p>
<ul class="simple">
<li><p>explain the need for hyperparameter optimization</p></li>
<li><p>carry out hyperparameter optimization using <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>’s <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> and <code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code></p></li>
<li><p>explain different hyperparameters of <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code></p></li>
<li><p>explain the importance of selecting a good range for the values.</p></li>
<li><p>explain optimization bias</p></li>
<li><p>identify and reason when to trust and not trust reported accuracies</p></li>
</ul>
<p><br><br><br><br></p>
</section>
</section>
<section id="hyperparameter-optimization-motivation">
<h2>Hyperparameter optimization motivation<a class="headerlink" href="#hyperparameter-optimization-motivation" title="Permalink to this headline">#</a></h2>
<section id="motivation">
<h3>Motivation<a class="headerlink" href="#motivation" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Remember that the fundamental goal of supervised machine learning is to generalize beyond what we see in the training examples.</p></li>
<li><p>We have been using data splitting and cross-validation to provide a framework to approximate generalization error.</p></li>
<li><p>With this framework, we can improve the model’s generalization performance by tuning model hyperparameters using cross-validation on the training set.</p></li>
</ul>
</section>
<section id="hyperparameters-the-problem">
<h3>Hyperparameters: the problem<a class="headerlink" href="#hyperparameters-the-problem" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>In order to improve the generalization performance, finding the best values for the important hyperparameters of a model is necessary for almost all models and datasets.</p></li>
<li><p>Picking good hyperparameters is important because if we don’t do it, we might end up with an underfit or overfit model.</p></li>
</ul>
</section>
<section id="some-ways-to-pick-hyperparameters">
<h3>Some ways to pick hyperparameters:<a class="headerlink" href="#some-ways-to-pick-hyperparameters" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Manual or expert knowledge or heuristics based optimization</p></li>
<li><p>Data-driven or automated optimization</p></li>
</ul>
<section id="manual-hyperparameter-optimization">
<h4>Manual hyperparameter optimization<a class="headerlink" href="#manual-hyperparameter-optimization" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>Advantage: we may have some intuition about what might work.</p>
<ul>
<li><p>E.g. if I’m massively overfitting, try decreasing <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> or <code class="docutils literal notranslate"><span class="pre">C</span></code>.</p></li>
</ul>
</li>
<li><p>Disadvantages</p>
<ul>
<li><p>it takes a lot of work</p></li>
<li><p>not reproducible</p></li>
<li><p>in very complicated cases, our intuition might be worse than a data-driven approach</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="automated-hyperparameter-optimization">
<h3>Automated hyperparameter optimization<a class="headerlink" href="#automated-hyperparameter-optimization" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Formulate the hyperparamter optimization as a one big search problem.</p></li>
<li><p>Often we have many hyperparameters of different types: Categorical, integer, and continuous.</p></li>
<li><p>Often, the search space is quite big and systematic search for optimal values is infeasible.</p></li>
</ul>
<p>In homework assignments, we have been carrying out hyperparameter search by exhaustively trying different possible combinations of the hyperparameters of interest.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mglearn</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_grid_search_overview</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/08_hyperparameter-optimization_16_0.png" src="../_images/08_hyperparameter-optimization_16_0.png" />
</div>
</div>
<p>Let’s look at an example of tuning <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> of the <code class="docutils literal notranslate"><span class="pre">DecisionTreeClassifier</span></code> on the Spotify dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spotify_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/spotify.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">X_spotify</span> <span class="o">=</span> <span class="n">spotify_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="s2">&quot;song_title&quot;</span><span class="p">,</span> <span class="s2">&quot;artist&quot;</span><span class="p">])</span>
<span class="n">y_spotify</span> <span class="o">=</span> <span class="n">spotify_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>
<span class="n">X_spotify</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>acousticness</th>
      <th>danceability</th>
      <th>duration_ms</th>
      <th>energy</th>
      <th>instrumentalness</th>
      <th>key</th>
      <th>liveness</th>
      <th>loudness</th>
      <th>mode</th>
      <th>speechiness</th>
      <th>tempo</th>
      <th>time_signature</th>
      <th>valence</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0102</td>
      <td>0.833</td>
      <td>204600</td>
      <td>0.434</td>
      <td>0.021900</td>
      <td>2</td>
      <td>0.1650</td>
      <td>-8.795</td>
      <td>1</td>
      <td>0.4310</td>
      <td>150.062</td>
      <td>4.0</td>
      <td>0.286</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.1990</td>
      <td>0.743</td>
      <td>326933</td>
      <td>0.359</td>
      <td>0.006110</td>
      <td>1</td>
      <td>0.1370</td>
      <td>-10.401</td>
      <td>1</td>
      <td>0.0794</td>
      <td>160.083</td>
      <td>4.0</td>
      <td>0.588</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0344</td>
      <td>0.838</td>
      <td>185707</td>
      <td>0.412</td>
      <td>0.000234</td>
      <td>2</td>
      <td>0.1590</td>
      <td>-7.148</td>
      <td>1</td>
      <td>0.2890</td>
      <td>75.044</td>
      <td>4.0</td>
      <td>0.173</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.6040</td>
      <td>0.494</td>
      <td>199413</td>
      <td>0.338</td>
      <td>0.510000</td>
      <td>5</td>
      <td>0.0922</td>
      <td>-15.236</td>
      <td>1</td>
      <td>0.0261</td>
      <td>86.468</td>
      <td>4.0</td>
      <td>0.230</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.1800</td>
      <td>0.678</td>
      <td>392893</td>
      <td>0.561</td>
      <td>0.512000</td>
      <td>5</td>
      <td>0.4390</td>
      <td>-11.648</td>
      <td>0</td>
      <td>0.0694</td>
      <td>174.004</td>
      <td>4.0</td>
      <td>0.904</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X_spotify</span><span class="p">,</span> <span class="n">y_spotify</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_score</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">)}</span>

<span class="n">results_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;mean_cv_score&quot;</span><span class="p">:</span> <span class="p">[]}</span>

<span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="n">param_grid</span><span class="p">[</span>
    <span class="s2">&quot;max_depth&quot;</span>
<span class="p">]:</span>  <span class="c1"># for each combination of parameters, train an SVC</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>  <span class="c1"># perform cross-validation</span>
    <span class="n">mean_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>  <span class="c1"># compute mean cross-validation accuracy</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">mean_score</span> <span class="o">&gt;</span> <span class="n">best_score</span>
    <span class="p">):</span>  <span class="c1"># if we got a better score, store the score and parameters</span>
        <span class="n">best_score</span> <span class="o">=</span> <span class="n">mean_score</span>
        <span class="n">best_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="n">depth</span><span class="p">}</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;max_depth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;mean_cv_score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_score</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;max_depth&#39;: 5}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_score</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.7191604330519393
</pre></div>
</div>
</div>
</div>
<p>Let’s try SVM RBF and tuning <code class="docutils literal notranslate"><span class="pre">C</span></code> and <code class="docutils literal notranslate"><span class="pre">gamma</span></code> on the same dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_svm</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">SVC</span><span class="p">())</span>  <span class="c1"># We need scaling for SVM RBF</span>
<span class="n">pipe_svm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()), (&#x27;svc&#x27;, SVC())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" ><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()), (&#x27;svc&#x27;, SVC())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">SVC</label><div class="sk-toggleable__content"><pre>SVC()</pre></div></div></div></div></div></div></div></div></div>
</div>
<p>Let’s try cross-validation with default hyperparameters of SVC.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">pipe_svm</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fit_time       0.028679
score_time     0.011716
test_score     0.738998
train_score    0.814011
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Now let’s try exhaustive hyperparameter search using for loops.</p>
<p>This is what we have been doing for this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">gamma</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]:</span> <span class="c1"># for some values of gamma</span>
    <span class="k">for</span> <span class="n">C</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]:</span> <span class="c1"># for some values of C</span>
        <span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="n">folds</span><span class="p">:</span>
            <span class="n">fit</span> <span class="ow">in</span> <span class="n">training</span> <span class="n">portion</span> <span class="k">with</span> <span class="n">the</span> <span class="n">given</span> <span class="n">C</span>
            <span class="n">score</span> <span class="n">on</span> <span class="n">validation</span> <span class="n">portion</span>
        <span class="n">compute</span> <span class="n">average</span> <span class="n">score</span>
        
<span class="n">pick</span> <span class="n">hyperparameter</span> <span class="n">values</span> <span class="n">which</span> <span class="k">yield</span> <span class="k">with</span> <span class="n">best</span> <span class="n">average</span> <span class="n">score</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_score</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
    <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
<span class="p">}</span>

<span class="n">results_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;mean_cv_score&quot;</span><span class="p">:</span> <span class="p">[]}</span>

<span class="k">for</span> <span class="n">gamma</span> <span class="ow">in</span> <span class="n">param_grid</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">C</span> <span class="ow">in</span> <span class="n">param_grid</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">]:</span>  <span class="c1"># for each combination of parameters, train an SVC</span>
        <span class="n">pipe_svm</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">SVC</span><span class="p">(</span><span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">))</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">pipe_svm</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>  <span class="c1"># perform cross-validation</span>
        <span class="n">mean_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>  <span class="c1"># compute mean cross-validation accuracy</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">mean_score</span> <span class="o">&gt;</span> <span class="n">best_score</span>
        <span class="p">):</span>  <span class="c1"># if we got a better score, store the score and parameters</span>
            <span class="n">best_score</span> <span class="o">=</span> <span class="n">mean_score</span>
            <span class="n">best_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="n">C</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="n">gamma</span><span class="p">}</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;mean_cv_score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_score</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_parameters</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;C&#39;: 1, &#39;gamma&#39;: 0.1}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_score</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.7439609253312309
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;mean_cv_score&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>C</th>
      <th>gamma</th>
      <th>mean_cv_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>15</th>
      <td>1.0</td>
      <td>0.100</td>
      <td>0.743961</td>
    </tr>
    <tr>
      <th>11</th>
      <td>100.0</td>
      <td>0.010</td>
      <td>0.732792</td>
    </tr>
    <tr>
      <th>16</th>
      <td>10.0</td>
      <td>0.100</td>
      <td>0.729091</td>
    </tr>
    <tr>
      <th>10</th>
      <td>10.0</td>
      <td>0.010</td>
      <td>0.720391</td>
    </tr>
    <tr>
      <th>17</th>
      <td>100.0</td>
      <td>0.100</td>
      <td>0.711715</td>
    </tr>
    <tr>
      <th>5</th>
      <td>100.0</td>
      <td>0.001</td>
      <td>0.704284</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.1</td>
      <td>0.100</td>
      <td>0.703034</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1.0</td>
      <td>0.010</td>
      <td>0.697473</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.1</td>
      <td>0.010</td>
      <td>0.678851</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10.0</td>
      <td>0.001</td>
      <td>0.678244</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">mean_cv_score</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

<span class="n">mglearn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
    <span class="n">scores</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">,</span>
    <span class="n">xticklabels</span><span class="o">=</span><span class="n">param_grid</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">],</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;gamma&quot;</span><span class="p">,</span>
    <span class="n">yticklabels</span><span class="o">=</span><span class="n">param_grid</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># plot the mean cross-validation scores</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PolyCollection at 0x14eb81000&gt;
</pre></div>
</div>
<img alt="../_images/08_hyperparameter-optimization_33_1.png" src="../_images/08_hyperparameter-optimization_33_1.png" />
</div>
</div>
<ul class="simple">
<li><p>We have 6 possible values for <code class="docutils literal notranslate"><span class="pre">C</span></code> and 6 possible values for <code class="docutils literal notranslate"><span class="pre">gamma</span></code>.</p></li>
<li><p>In 5-fold cross-validation, for each combination of parameter values, five accuracies are computed.</p></li>
<li><p>So to evaluate the accuracy of the SVM using 6 values of <code class="docutils literal notranslate"><span class="pre">C</span></code> and 6 values of <code class="docutils literal notranslate"><span class="pre">gamma</span></code> using five-fold cross-validation, we need to train 36 * 5 = 180 models!</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>36
</pre></div>
</div>
</div>
</div>
<p>Once we have optimized hyperparameters, we retrain a model on the full training set with these optimized hyperparameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_svm</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">SVC</span><span class="p">(</span><span class="o">**</span><span class="n">best_parameters</span><span class="p">))</span>
<span class="n">pipe_svm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span>
<span class="p">)</span>  <span class="c1"># Retrain a model with optimized hyperparameters on the combined training and validation set</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                (&#x27;svc&#x27;, SVC(C=1, gamma=0.1))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" ><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                (&#x27;svc&#x27;, SVC(C=1, gamma=0.1))])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" ><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" ><label for="sk-estimator-id-6" class="sk-toggleable__label sk-toggleable__label-arrow">SVC</label><div class="sk-toggleable__content"><pre>SVC(C=1, gamma=0.1)</pre></div></div></div></div></div></div></div></div></div>
</div>
<p>And finally evaluate the performance of this model on the test set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_svm</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>  <span class="c1"># Final evaluation on the test data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.7376237623762376
</pre></div>
</div>
</div>
</div>
<p>This process is so common that there are some standard methods in <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> where we can carry out all of this in a more compact way.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mglearn</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_grid_search_overview</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/08_hyperparameter-optimization_41_0.png" src="../_images/08_hyperparameter-optimization_41_0.png" />
</div>
</div>
<p>In this lecture we are going to talk about two such most commonly used automated optimizations methods from <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>.</p>
<ul class="simple">
<li><p>Exhaustive grid search: <a class="reference external" href="http://scikit-learn.org/stable/modules/generated/sklearn.model_selection.GridSearchCV.html"><code class="docutils literal notranslate"><span class="pre">sklearn.model_selection.GridSearchCV</span></code></a></p></li>
<li><p>Randomized search: <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.RandomizedSearchCV.html"><code class="docutils literal notranslate"><span class="pre">sklearn.model_selection.RandomizedSearchCV</span></code></a></p></li>
</ul>
<p>The “CV” stands for cross-validation; these methods have built-in cross-validation.</p>
<p><br><br><br><br></p>
</section>
</section>
<section id="exhaustive-grid-search-sklearn-model-selection-gridsearchcv">
<h2>Exhaustive grid search: <a class="reference external" href="http://scikit-learn.org/stable/modules/generated/sklearn.model_selection.GridSearchCV.html"><code class="docutils literal notranslate"><span class="pre">sklearn.model_selection.GridSearchCV</span></code></a><a class="headerlink" href="#exhaustive-grid-search-sklearn-model-selection-gridsearchcv" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>For <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> we need</p>
<ul>
<li><p>an instantiated model or a pipeline</p></li>
<li><p>a parameter grid: A user specifies a set of values for each hyperparameter.</p></li>
<li><p>other optional arguments</p></li>
</ul>
</li>
</ul>
<p>The method considers product of the sets and evaluates each combination one by one.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>

<span class="n">pipe_svm</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">SVC</span><span class="p">())</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;svc__gamma&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
    <span class="s2">&quot;svc__C&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
<span class="p">}</span>

<span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
    <span class="n">pipe_svm</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">set_config</span>

<span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s2">&quot;diagram&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> object above behaves like a classifier. We can call <code class="docutils literal notranslate"><span class="pre">fit</span></code>, <code class="docutils literal notranslate"><span class="pre">predict</span></code> or <code class="docutils literal notranslate"><span class="pre">score</span></code> on it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span> <span class="c1"># all the work is done here</span>
<span class="n">grid_search</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-3 {color: black;background-color: white;}#sk-container-id-3 pre{padding: 0;}#sk-container-id-3 div.sk-toggleable {background-color: white;}#sk-container-id-3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-3 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-3 div.sk-item {position: relative;z-index: 1;}#sk-container-id-3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-3 div.sk-item::before, #sk-container-id-3 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-3 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-3 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-3 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-3 div.sk-label-container {text-align: center;}#sk-container-id-3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-3 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                                       (&#x27;svc&#x27;, SVC())]),
             n_jobs=-1,
             param_grid={&#x27;svc__C&#x27;: [0.001, 0.01, 0.1, 1.0, 10, 100],
                         &#x27;svc__gamma&#x27;: [0.001, 0.01, 0.1, 1.0, 10, 100]},
             return_train_score=True)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox" ><label for="sk-estimator-id-7" class="sk-toggleable__label sk-toggleable__label-arrow">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                                       (&#x27;svc&#x27;, SVC())]),
             n_jobs=-1,
             param_grid={&#x27;svc__C&#x27;: [0.001, 0.01, 0.1, 1.0, 10, 100],
                         &#x27;svc__gamma&#x27;: [0.001, 0.01, 0.1, 1.0, 10, 100]},
             return_train_score=True)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox" ><label for="sk-estimator-id-8" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()), (&#x27;svc&#x27;, SVC())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox" ><label for="sk-estimator-id-9" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox" ><label for="sk-estimator-id-10" class="sk-toggleable__label sk-toggleable__label-arrow">SVC</label><div class="sk-toggleable__content"><pre>SVC()</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<p>Fitting the <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> object</p>
<ul class="simple">
<li><p>Searches for the best hyperparameter values</p></li>
<li><p>You can access the best score and the best hyperparameters using <code class="docutils literal notranslate"><span class="pre">best_score_</span></code> and <code class="docutils literal notranslate"><span class="pre">best_params_</span></code> attributes, respectively.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.7439609253312309
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;svc__C&#39;: 1.0, &#39;svc__gamma&#39;: 0.1}
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>It is often helpful to visualize results of all cross-validation experiments.</p></li>
<li><p>You can access this information using <code class="docutils literal notranslate"><span class="pre">cv_results_</span></code> attribute of a fitted <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> object.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span>
<span class="n">results</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>26</th>
      <th>27</th>
      <th>28</th>
      <th>29</th>
      <th>30</th>
      <th>31</th>
      <th>32</th>
      <th>33</th>
      <th>34</th>
      <th>35</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mean_fit_time</th>
      <td>0.062793</td>
      <td>0.058614</td>
      <td>0.063919</td>
      <td>0.060882</td>
      <td>0.057725</td>
      <td>0.050473</td>
      <td>0.056672</td>
      <td>0.064995</td>
      <td>0.058973</td>
      <td>0.054828</td>
      <td>...</td>
      <td>0.055524</td>
      <td>0.067481</td>
      <td>0.069824</td>
      <td>0.061908</td>
      <td>0.05238</td>
      <td>0.06844</td>
      <td>0.117454</td>
      <td>0.070787</td>
      <td>0.070302</td>
      <td>0.05866</td>
    </tr>
    <tr>
      <th>std_fit_time</th>
      <td>0.005506</td>
      <td>0.002861</td>
      <td>0.012315</td>
      <td>0.016001</td>
      <td>0.012278</td>
      <td>0.002147</td>
      <td>0.00716</td>
      <td>0.015978</td>
      <td>0.015619</td>
      <td>0.004158</td>
      <td>...</td>
      <td>0.003121</td>
      <td>0.006162</td>
      <td>0.003479</td>
      <td>0.005306</td>
      <td>0.004089</td>
      <td>0.006129</td>
      <td>0.025728</td>
      <td>0.004736</td>
      <td>0.006075</td>
      <td>0.003409</td>
    </tr>
    <tr>
      <th>mean_score_time</th>
      <td>0.024977</td>
      <td>0.022647</td>
      <td>0.02613</td>
      <td>0.026909</td>
      <td>0.023162</td>
      <td>0.02369</td>
      <td>0.021383</td>
      <td>0.026115</td>
      <td>0.02591</td>
      <td>0.024633</td>
      <td>...</td>
      <td>0.016269</td>
      <td>0.02482</td>
      <td>0.02658</td>
      <td>0.02525</td>
      <td>0.018853</td>
      <td>0.013924</td>
      <td>0.011534</td>
      <td>0.024112</td>
      <td>0.02782</td>
      <td>0.022484</td>
    </tr>
    <tr>
      <th>std_score_time</th>
      <td>0.001469</td>
      <td>0.002438</td>
      <td>0.002586</td>
      <td>0.003725</td>
      <td>0.007611</td>
      <td>0.003962</td>
      <td>0.003419</td>
      <td>0.010773</td>
      <td>0.008483</td>
      <td>0.002034</td>
      <td>...</td>
      <td>0.001706</td>
      <td>0.004048</td>
      <td>0.00228</td>
      <td>0.001567</td>
      <td>0.00073</td>
      <td>0.002232</td>
      <td>0.002525</td>
      <td>0.001953</td>
      <td>0.001854</td>
      <td>0.002866</td>
    </tr>
    <tr>
      <th>param_svc__C</th>
      <td>0.001</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>...</td>
      <td>10</td>
      <td>10</td>
      <td>10</td>
      <td>10</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
    </tr>
    <tr>
      <th>param_svc__gamma</th>
      <td>0.001</td>
      <td>0.01</td>
      <td>0.1</td>
      <td>1.0</td>
      <td>10</td>
      <td>100</td>
      <td>0.001</td>
      <td>0.01</td>
      <td>0.1</td>
      <td>1.0</td>
      <td>...</td>
      <td>0.1</td>
      <td>1.0</td>
      <td>10</td>
      <td>100</td>
      <td>0.001</td>
      <td>0.01</td>
      <td>0.1</td>
      <td>1.0</td>
      <td>10</td>
      <td>100</td>
    </tr>
    <tr>
      <th>params</th>
      <td>{'svc__C': 0.001, 'svc__gamma': 0.001}</td>
      <td>{'svc__C': 0.001, 'svc__gamma': 0.01}</td>
      <td>{'svc__C': 0.001, 'svc__gamma': 0.1}</td>
      <td>{'svc__C': 0.001, 'svc__gamma': 1.0}</td>
      <td>{'svc__C': 0.001, 'svc__gamma': 10}</td>
      <td>{'svc__C': 0.001, 'svc__gamma': 100}</td>
      <td>{'svc__C': 0.01, 'svc__gamma': 0.001}</td>
      <td>{'svc__C': 0.01, 'svc__gamma': 0.01}</td>
      <td>{'svc__C': 0.01, 'svc__gamma': 0.1}</td>
      <td>{'svc__C': 0.01, 'svc__gamma': 1.0}</td>
      <td>...</td>
      <td>{'svc__C': 10, 'svc__gamma': 0.1}</td>
      <td>{'svc__C': 10, 'svc__gamma': 1.0}</td>
      <td>{'svc__C': 10, 'svc__gamma': 10}</td>
      <td>{'svc__C': 10, 'svc__gamma': 100}</td>
      <td>{'svc__C': 100, 'svc__gamma': 0.001}</td>
      <td>{'svc__C': 100, 'svc__gamma': 0.01}</td>
      <td>{'svc__C': 100, 'svc__gamma': 0.1}</td>
      <td>{'svc__C': 100, 'svc__gamma': 1.0}</td>
      <td>{'svc__C': 100, 'svc__gamma': 10}</td>
      <td>{'svc__C': 100, 'svc__gamma': 100}</td>
    </tr>
    <tr>
      <th>split0_test_score</th>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>...</td>
      <td>0.702786</td>
      <td>0.671827</td>
      <td>0.517028</td>
      <td>0.504644</td>
      <td>0.73065</td>
      <td>0.73065</td>
      <td>0.705882</td>
      <td>0.671827</td>
      <td>0.517028</td>
      <td>0.504644</td>
    </tr>
    <tr>
      <th>split1_test_score</th>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>...</td>
      <td>0.767802</td>
      <td>0.671827</td>
      <td>0.510836</td>
      <td>0.510836</td>
      <td>0.708978</td>
      <td>0.758514</td>
      <td>0.76161</td>
      <td>0.671827</td>
      <td>0.510836</td>
      <td>0.510836</td>
    </tr>
    <tr>
      <th>split2_test_score</th>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>...</td>
      <td>0.693498</td>
      <td>0.662539</td>
      <td>0.517028</td>
      <td>0.50774</td>
      <td>0.662539</td>
      <td>0.71517</td>
      <td>0.671827</td>
      <td>0.662539</td>
      <td>0.517028</td>
      <td>0.50774</td>
    </tr>
    <tr>
      <th>split3_test_score</th>
      <td>0.506211</td>
      <td>0.506211</td>
      <td>0.506211</td>
      <td>0.506211</td>
      <td>0.506211</td>
      <td>0.506211</td>
      <td>0.506211</td>
      <td>0.506211</td>
      <td>0.506211</td>
      <td>0.506211</td>
      <td>...</td>
      <td>0.736025</td>
      <td>0.667702</td>
      <td>0.515528</td>
      <td>0.509317</td>
      <td>0.723602</td>
      <td>0.720497</td>
      <td>0.708075</td>
      <td>0.667702</td>
      <td>0.515528</td>
      <td>0.509317</td>
    </tr>
    <tr>
      <th>split4_test_score</th>
      <td>0.509317</td>
      <td>0.509317</td>
      <td>0.509317</td>
      <td>0.509317</td>
      <td>0.509317</td>
      <td>0.509317</td>
      <td>0.509317</td>
      <td>0.509317</td>
      <td>0.509317</td>
      <td>0.509317</td>
      <td>...</td>
      <td>0.745342</td>
      <td>0.68323</td>
      <td>0.515528</td>
      <td>0.509317</td>
      <td>0.695652</td>
      <td>0.73913</td>
      <td>0.71118</td>
      <td>0.68323</td>
      <td>0.515528</td>
      <td>0.509317</td>
    </tr>
    <tr>
      <th>mean_test_score</th>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>...</td>
      <td>0.729091</td>
      <td>0.671425</td>
      <td>0.51519</td>
      <td>0.508371</td>
      <td>0.704284</td>
      <td>0.732792</td>
      <td>0.711715</td>
      <td>0.671425</td>
      <td>0.51519</td>
      <td>0.508371</td>
    </tr>
    <tr>
      <th>std_test_score</th>
      <td>0.000982</td>
      <td>0.000982</td>
      <td>0.000982</td>
      <td>0.000982</td>
      <td>0.000982</td>
      <td>0.000982</td>
      <td>0.000982</td>
      <td>0.000982</td>
      <td>0.000982</td>
      <td>0.000982</td>
      <td>...</td>
      <td>0.027457</td>
      <td>0.006819</td>
      <td>0.002278</td>
      <td>0.002105</td>
      <td>0.024115</td>
      <td>0.015284</td>
      <td>0.028734</td>
      <td>0.006819</td>
      <td>0.002278</td>
      <td>0.002105</td>
    </tr>
    <tr>
      <th>rank_test_score</th>
      <td>21</td>
      <td>21</td>
      <td>21</td>
      <td>21</td>
      <td>21</td>
      <td>21</td>
      <td>21</td>
      <td>21</td>
      <td>21</td>
      <td>21</td>
      <td>...</td>
      <td>3</td>
      <td>11</td>
      <td>15</td>
      <td>18</td>
      <td>6</td>
      <td>2</td>
      <td>5</td>
      <td>11</td>
      <td>15</td>
      <td>18</td>
    </tr>
    <tr>
      <th>split0_train_score</th>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>...</td>
      <td>0.923256</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.703876</td>
      <td>0.80155</td>
      <td>0.990698</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>split1_train_score</th>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>...</td>
      <td>0.91938</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.712403</td>
      <td>0.796899</td>
      <td>0.987597</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>split2_train_score</th>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>...</td>
      <td>0.925581</td>
      <td>0.999225</td>
      <td>0.999225</td>
      <td>0.999225</td>
      <td>0.726357</td>
      <td>0.813953</td>
      <td>0.989147</td>
      <td>0.999225</td>
      <td>0.999225</td>
      <td>0.999225</td>
    </tr>
    <tr>
      <th>split3_train_score</th>
      <td>0.508133</td>
      <td>0.508133</td>
      <td>0.508133</td>
      <td>0.508133</td>
      <td>0.508133</td>
      <td>0.508133</td>
      <td>0.508133</td>
      <td>0.508133</td>
      <td>0.508133</td>
      <td>0.508133</td>
      <td>...</td>
      <td>0.923315</td>
      <td>0.999225</td>
      <td>0.999225</td>
      <td>0.999225</td>
      <td>0.710302</td>
      <td>0.797831</td>
      <td>0.984508</td>
      <td>0.999225</td>
      <td>0.999225</td>
      <td>0.999225</td>
    </tr>
    <tr>
      <th>split4_train_score</th>
      <td>0.507359</td>
      <td>0.507359</td>
      <td>0.507359</td>
      <td>0.507359</td>
      <td>0.507359</td>
      <td>0.507359</td>
      <td>0.507359</td>
      <td>0.507359</td>
      <td>0.507359</td>
      <td>0.507359</td>
      <td>...</td>
      <td>0.915569</td>
      <td>0.999225</td>
      <td>0.999225</td>
      <td>0.999225</td>
      <td>0.71495</td>
      <td>0.793958</td>
      <td>0.986057</td>
      <td>0.999225</td>
      <td>0.999225</td>
      <td>0.999225</td>
    </tr>
    <tr>
      <th>mean_train_score</th>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>...</td>
      <td>0.92142</td>
      <td>0.999535</td>
      <td>0.999535</td>
      <td>0.999535</td>
      <td>0.713577</td>
      <td>0.800838</td>
      <td>0.987601</td>
      <td>0.999535</td>
      <td>0.999535</td>
      <td>0.999535</td>
    </tr>
    <tr>
      <th>std_train_score</th>
      <td>0.000245</td>
      <td>0.000245</td>
      <td>0.000245</td>
      <td>0.000245</td>
      <td>0.000245</td>
      <td>0.000245</td>
      <td>0.000245</td>
      <td>0.000245</td>
      <td>0.000245</td>
      <td>0.000245</td>
      <td>...</td>
      <td>0.00354</td>
      <td>0.00038</td>
      <td>0.00038</td>
      <td>0.00038</td>
      <td>0.007368</td>
      <td>0.006992</td>
      <td>0.002188</td>
      <td>0.00038</td>
      <td>0.00038</td>
      <td>0.00038</td>
    </tr>
  </tbody>
</table>
<p>22 rows × 36 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;rank_test_score&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>rank_test_score</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>10</th>
      <th>...</th>
      <th>21</th>
      <th>21</th>
      <th>21</th>
      <th>21</th>
      <th>21</th>
      <th>21</th>
      <th>21</th>
      <th>21</th>
      <th>21</th>
      <th>21</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mean_fit_time</th>
      <td>0.048165</td>
      <td>0.06844</td>
      <td>0.055524</td>
      <td>0.049312</td>
      <td>0.117454</td>
      <td>0.05238</td>
      <td>0.05302</td>
      <td>0.049199</td>
      <td>0.05494</td>
      <td>0.049577</td>
      <td>...</td>
      <td>0.058973</td>
      <td>0.064995</td>
      <td>0.056672</td>
      <td>0.050473</td>
      <td>0.057725</td>
      <td>0.060882</td>
      <td>0.063919</td>
      <td>0.058614</td>
      <td>0.06953</td>
      <td>0.054855</td>
    </tr>
    <tr>
      <th>std_fit_time</th>
      <td>0.006356</td>
      <td>0.006129</td>
      <td>0.003121</td>
      <td>0.001145</td>
      <td>0.025728</td>
      <td>0.004089</td>
      <td>0.008778</td>
      <td>0.002421</td>
      <td>0.00355</td>
      <td>0.002058</td>
      <td>...</td>
      <td>0.015619</td>
      <td>0.015978</td>
      <td>0.00716</td>
      <td>0.002147</td>
      <td>0.012278</td>
      <td>0.016001</td>
      <td>0.012315</td>
      <td>0.002861</td>
      <td>0.014482</td>
      <td>0.002527</td>
    </tr>
    <tr>
      <th>mean_score_time</th>
      <td>0.019609</td>
      <td>0.013924</td>
      <td>0.016269</td>
      <td>0.016306</td>
      <td>0.011534</td>
      <td>0.018853</td>
      <td>0.021036</td>
      <td>0.020352</td>
      <td>0.023676</td>
      <td>0.020492</td>
      <td>...</td>
      <td>0.02591</td>
      <td>0.026115</td>
      <td>0.021383</td>
      <td>0.02369</td>
      <td>0.023162</td>
      <td>0.026909</td>
      <td>0.02613</td>
      <td>0.022647</td>
      <td>0.026748</td>
      <td>0.026355</td>
    </tr>
    <tr>
      <th>std_score_time</th>
      <td>0.00714</td>
      <td>0.002232</td>
      <td>0.001706</td>
      <td>0.001479</td>
      <td>0.002525</td>
      <td>0.00073</td>
      <td>0.006397</td>
      <td>0.000201</td>
      <td>0.000647</td>
      <td>0.000596</td>
      <td>...</td>
      <td>0.008483</td>
      <td>0.010773</td>
      <td>0.003419</td>
      <td>0.003962</td>
      <td>0.007611</td>
      <td>0.003725</td>
      <td>0.002586</td>
      <td>0.002438</td>
      <td>0.002744</td>
      <td>0.002466</td>
    </tr>
    <tr>
      <th>param_svc__C</th>
      <td>1.0</td>
      <td>100</td>
      <td>10</td>
      <td>10</td>
      <td>100</td>
      <td>100</td>
      <td>0.1</td>
      <td>1.0</td>
      <td>0.1</td>
      <td>10</td>
      <td>...</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0.1</td>
      <td>0.1</td>
    </tr>
    <tr>
      <th>param_svc__gamma</th>
      <td>0.1</td>
      <td>0.01</td>
      <td>0.1</td>
      <td>0.01</td>
      <td>0.1</td>
      <td>0.001</td>
      <td>0.1</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.001</td>
      <td>...</td>
      <td>0.1</td>
      <td>0.01</td>
      <td>0.001</td>
      <td>100</td>
      <td>10</td>
      <td>1.0</td>
      <td>0.1</td>
      <td>0.01</td>
      <td>10</td>
      <td>100</td>
    </tr>
    <tr>
      <th>params</th>
      <td>{'svc__C': 1.0, 'svc__gamma': 0.1}</td>
      <td>{'svc__C': 100, 'svc__gamma': 0.01}</td>
      <td>{'svc__C': 10, 'svc__gamma': 0.1}</td>
      <td>{'svc__C': 10, 'svc__gamma': 0.01}</td>
      <td>{'svc__C': 100, 'svc__gamma': 0.1}</td>
      <td>{'svc__C': 100, 'svc__gamma': 0.001}</td>
      <td>{'svc__C': 0.1, 'svc__gamma': 0.1}</td>
      <td>{'svc__C': 1.0, 'svc__gamma': 0.01}</td>
      <td>{'svc__C': 0.1, 'svc__gamma': 0.01}</td>
      <td>{'svc__C': 10, 'svc__gamma': 0.001}</td>
      <td>...</td>
      <td>{'svc__C': 0.01, 'svc__gamma': 0.1}</td>
      <td>{'svc__C': 0.01, 'svc__gamma': 0.01}</td>
      <td>{'svc__C': 0.01, 'svc__gamma': 0.001}</td>
      <td>{'svc__C': 0.001, 'svc__gamma': 100}</td>
      <td>{'svc__C': 0.001, 'svc__gamma': 10}</td>
      <td>{'svc__C': 0.001, 'svc__gamma': 1.0}</td>
      <td>{'svc__C': 0.001, 'svc__gamma': 0.1}</td>
      <td>{'svc__C': 0.001, 'svc__gamma': 0.01}</td>
      <td>{'svc__C': 0.1, 'svc__gamma': 10}</td>
      <td>{'svc__C': 0.1, 'svc__gamma': 100}</td>
    </tr>
    <tr>
      <th>split0_test_score</th>
      <td>0.755418</td>
      <td>0.73065</td>
      <td>0.702786</td>
      <td>0.739938</td>
      <td>0.705882</td>
      <td>0.73065</td>
      <td>0.705882</td>
      <td>0.702786</td>
      <td>0.693498</td>
      <td>0.69969</td>
      <td>...</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
    </tr>
    <tr>
      <th>split1_test_score</th>
      <td>0.755418</td>
      <td>0.758514</td>
      <td>0.767802</td>
      <td>0.733746</td>
      <td>0.76161</td>
      <td>0.708978</td>
      <td>0.718266</td>
      <td>0.705882</td>
      <td>0.702786</td>
      <td>0.674923</td>
      <td>...</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
    </tr>
    <tr>
      <th>split2_test_score</th>
      <td>0.712074</td>
      <td>0.71517</td>
      <td>0.693498</td>
      <td>0.696594</td>
      <td>0.671827</td>
      <td>0.662539</td>
      <td>0.690402</td>
      <td>0.659443</td>
      <td>0.653251</td>
      <td>0.653251</td>
      <td>...</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
      <td>0.50774</td>
    </tr>
    <tr>
      <th>split3_test_score</th>
      <td>0.754658</td>
      <td>0.720497</td>
      <td>0.736025</td>
      <td>0.720497</td>
      <td>0.708075</td>
      <td>0.723602</td>
      <td>0.692547</td>
      <td>0.726708</td>
      <td>0.664596</td>
      <td>0.680124</td>
      <td>...</td>
      <td>0.506211</td>
      <td>0.506211</td>
      <td>0.506211</td>
      <td>0.506211</td>
      <td>0.506211</td>
      <td>0.506211</td>
      <td>0.506211</td>
      <td>0.506211</td>
      <td>0.506211</td>
      <td>0.506211</td>
    </tr>
    <tr>
      <th>split4_test_score</th>
      <td>0.742236</td>
      <td>0.73913</td>
      <td>0.745342</td>
      <td>0.71118</td>
      <td>0.71118</td>
      <td>0.695652</td>
      <td>0.708075</td>
      <td>0.692547</td>
      <td>0.680124</td>
      <td>0.68323</td>
      <td>...</td>
      <td>0.509317</td>
      <td>0.509317</td>
      <td>0.509317</td>
      <td>0.509317</td>
      <td>0.509317</td>
      <td>0.509317</td>
      <td>0.509317</td>
      <td>0.509317</td>
      <td>0.509317</td>
      <td>0.509317</td>
    </tr>
    <tr>
      <th>mean_test_score</th>
      <td>0.743961</td>
      <td>0.732792</td>
      <td>0.729091</td>
      <td>0.720391</td>
      <td>0.711715</td>
      <td>0.704284</td>
      <td>0.703034</td>
      <td>0.697473</td>
      <td>0.678851</td>
      <td>0.678244</td>
      <td>...</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
    </tr>
    <tr>
      <th>std_test_score</th>
      <td>0.016713</td>
      <td>0.015284</td>
      <td>0.027457</td>
      <td>0.015566</td>
      <td>0.028734</td>
      <td>0.024115</td>
      <td>0.010345</td>
      <td>0.022019</td>
      <td>0.018153</td>
      <td>0.014994</td>
      <td>...</td>
      <td>0.000982</td>
      <td>0.000982</td>
      <td>0.000982</td>
      <td>0.000982</td>
      <td>0.000982</td>
      <td>0.000982</td>
      <td>0.000982</td>
      <td>0.000982</td>
      <td>0.000982</td>
      <td>0.000982</td>
    </tr>
    <tr>
      <th>split0_train_score</th>
      <td>0.827132</td>
      <td>0.80155</td>
      <td>0.923256</td>
      <td>0.751938</td>
      <td>0.990698</td>
      <td>0.703876</td>
      <td>0.730233</td>
      <td>0.708527</td>
      <td>0.675194</td>
      <td>0.67907</td>
      <td>...</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
    </tr>
    <tr>
      <th>split1_train_score</th>
      <td>0.829457</td>
      <td>0.796899</td>
      <td>0.91938</td>
      <td>0.757364</td>
      <td>0.987597</td>
      <td>0.712403</td>
      <td>0.724806</td>
      <td>0.700775</td>
      <td>0.676744</td>
      <td>0.682946</td>
      <td>...</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
    </tr>
    <tr>
      <th>split2_train_score</th>
      <td>0.83876</td>
      <td>0.813953</td>
      <td>0.925581</td>
      <td>0.760465</td>
      <td>0.989147</td>
      <td>0.726357</td>
      <td>0.737984</td>
      <td>0.723256</td>
      <td>0.683721</td>
      <td>0.694574</td>
      <td>...</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
      <td>0.507752</td>
    </tr>
    <tr>
      <th>split3_train_score</th>
      <td>0.831913</td>
      <td>0.797831</td>
      <td>0.923315</td>
      <td>0.759876</td>
      <td>0.984508</td>
      <td>0.710302</td>
      <td>0.729667</td>
      <td>0.701007</td>
      <td>0.681642</td>
      <td>0.688613</td>
      <td>...</td>
      <td>0.508133</td>
      <td>0.508133</td>
      <td>0.508133</td>
      <td>0.508133</td>
      <td>0.508133</td>
      <td>0.508133</td>
      <td>0.508133</td>
      <td>0.508133</td>
      <td>0.508133</td>
      <td>0.508133</td>
    </tr>
    <tr>
      <th>split4_train_score</th>
      <td>0.832688</td>
      <td>0.793958</td>
      <td>0.915569</td>
      <td>0.75213</td>
      <td>0.986057</td>
      <td>0.71495</td>
      <td>0.725019</td>
      <td>0.718048</td>
      <td>0.680868</td>
      <td>0.687064</td>
      <td>...</td>
      <td>0.507359</td>
      <td>0.507359</td>
      <td>0.507359</td>
      <td>0.507359</td>
      <td>0.507359</td>
      <td>0.507359</td>
      <td>0.507359</td>
      <td>0.507359</td>
      <td>0.507359</td>
      <td>0.507359</td>
    </tr>
    <tr>
      <th>mean_train_score</th>
      <td>0.83199</td>
      <td>0.800838</td>
      <td>0.92142</td>
      <td>0.756355</td>
      <td>0.987601</td>
      <td>0.713577</td>
      <td>0.729542</td>
      <td>0.710323</td>
      <td>0.679634</td>
      <td>0.686453</td>
      <td>...</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
    </tr>
    <tr>
      <th>std_train_score</th>
      <td>0.003907</td>
      <td>0.006992</td>
      <td>0.00354</td>
      <td>0.003679</td>
      <td>0.002188</td>
      <td>0.007368</td>
      <td>0.004789</td>
      <td>0.009034</td>
      <td>0.003172</td>
      <td>0.00525</td>
      <td>...</td>
      <td>0.000245</td>
      <td>0.000245</td>
      <td>0.000245</td>
      <td>0.000245</td>
      <td>0.000245</td>
      <td>0.000245</td>
      <td>0.000245</td>
      <td>0.000245</td>
      <td>0.000245</td>
      <td>0.000245</td>
    </tr>
  </tbody>
</table>
<p>21 rows × 36 columns</p>
</div></div></div>
</div>
<p>Let’s only look at the most relevant rows.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)[</span>
    <span class="p">[</span>
        <span class="s2">&quot;mean_test_score&quot;</span><span class="p">,</span>
        <span class="s2">&quot;param_svc__gamma&quot;</span><span class="p">,</span>
        <span class="s2">&quot;param_svc__C&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mean_fit_time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rank_test_score&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;rank_test_score&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>rank_test_score</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>10</th>
      <th>...</th>
      <th>21</th>
      <th>21</th>
      <th>21</th>
      <th>21</th>
      <th>21</th>
      <th>21</th>
      <th>21</th>
      <th>21</th>
      <th>21</th>
      <th>21</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mean_test_score</th>
      <td>0.743961</td>
      <td>0.732792</td>
      <td>0.729091</td>
      <td>0.720391</td>
      <td>0.711715</td>
      <td>0.704284</td>
      <td>0.703034</td>
      <td>0.697473</td>
      <td>0.678851</td>
      <td>0.678244</td>
      <td>...</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
      <td>0.50775</td>
    </tr>
    <tr>
      <th>param_svc__gamma</th>
      <td>0.1</td>
      <td>0.01</td>
      <td>0.1</td>
      <td>0.01</td>
      <td>0.1</td>
      <td>0.001</td>
      <td>0.1</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.001</td>
      <td>...</td>
      <td>0.1</td>
      <td>0.01</td>
      <td>0.001</td>
      <td>100</td>
      <td>10</td>
      <td>1.0</td>
      <td>0.1</td>
      <td>0.01</td>
      <td>10</td>
      <td>100</td>
    </tr>
    <tr>
      <th>param_svc__C</th>
      <td>1.0</td>
      <td>100</td>
      <td>10</td>
      <td>10</td>
      <td>100</td>
      <td>100</td>
      <td>0.1</td>
      <td>1.0</td>
      <td>0.1</td>
      <td>10</td>
      <td>...</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0.1</td>
      <td>0.1</td>
    </tr>
    <tr>
      <th>mean_fit_time</th>
      <td>0.048165</td>
      <td>0.06844</td>
      <td>0.055524</td>
      <td>0.049312</td>
      <td>0.117454</td>
      <td>0.05238</td>
      <td>0.05302</td>
      <td>0.049199</td>
      <td>0.05494</td>
      <td>0.049577</td>
      <td>...</td>
      <td>0.058973</td>
      <td>0.064995</td>
      <td>0.056672</td>
      <td>0.050473</td>
      <td>0.057725</td>
      <td>0.060882</td>
      <td>0.063919</td>
      <td>0.058614</td>
      <td>0.06953</td>
      <td>0.054855</td>
    </tr>
  </tbody>
</table>
<p>4 rows × 36 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>Other than searching for best hyperparameter values, <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> also fits a new model on the whole training set with the parameters that yielded the best results.</p></li>
<li><p>So we can conveniently call <code class="docutils literal notranslate"><span class="pre">score</span></code> on the test set with a fitted <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> object.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid_search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.7376237623762376
</pre></div>
</div>
</div>
</div>
<p>Why are <code class="docutils literal notranslate"><span class="pre">best_score_</span></code> and the score above different?</p>
<section id="n-jobs-1">
<h3><code class="docutils literal notranslate"><span class="pre">n_jobs=-1</span></code><a class="headerlink" href="#n-jobs-1" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Note the <code class="docutils literal notranslate"><span class="pre">n_jobs=-1</span></code> above.</p></li>
<li><p>Hyperparameter optimization can be done <em>in parallel</em> for each of the configurations.</p></li>
<li><p>This is very useful when scaling up to large numbers of machines in the cloud.</p></li>
</ul>
</section>
<section id="the-syntax">
<h3>The <code class="docutils literal notranslate"><span class="pre">__</span></code> syntax<a class="headerlink" href="#the-syntax" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Above: we have a nesting of transformers.</p></li>
<li><p>We can access the parameters of the “inner” objects by using __ to go “deeper”:</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">svc__gamma</span></code>: the <code class="docutils literal notranslate"><span class="pre">gamma</span></code> of the <code class="docutils literal notranslate"><span class="pre">svc</span></code> of the pipeline</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">svc__C</span></code>: the <code class="docutils literal notranslate"><span class="pre">C</span></code> of the <code class="docutils literal notranslate"><span class="pre">svc</span></code> of the pipeline</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>

<span class="n">pipe_svm</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">SVC</span><span class="p">())</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;svc__gamma&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
    <span class="s2">&quot;svc__C&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
<span class="p">}</span>

<span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
    <span class="n">pipe_svm</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="c1"># grid_search.fit(X_train, y_train)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="range-of-c">
<h3>Range of <code class="docutils literal notranslate"><span class="pre">C</span></code><a class="headerlink" href="#range-of-c" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Note the exponential range for <code class="docutils literal notranslate"><span class="pre">C</span></code>. This is quite common.</p></li>
<li><p>There is no point trying <span class="math notranslate nohighlight">\(C=\{1,2,3\ldots,100\}\)</span> because <span class="math notranslate nohighlight">\(C=1,2,3\)</span> are too similar to each other.</p></li>
<li><p>Often we’re trying to find an order of magnitude, e.g. <span class="math notranslate nohighlight">\(C=\{0.01,0.1,1,10,100\}\)</span>.</p></li>
<li><p>We can also write that as <span class="math notranslate nohighlight">\(C=\{10^{-2},10^{-1},10^0,10^1,10^2\}\)</span>.</p></li>
<li><p>Or, in other words, <span class="math notranslate nohighlight">\(C\)</span> values to try are <span class="math notranslate nohighlight">\(10^n\)</span> for <span class="math notranslate nohighlight">\(n=-2,-1,0,1,2\)</span> which is basically what we have above.</p></li>
</ul>
<p><br><br></p>
</section>
<section id="visualizing-the-parameter-grid-as-a-heatmap">
<h3>Visualizing the parameter grid as a heatmap<a class="headerlink" href="#visualizing-the-parameter-grid-as-a-heatmap" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">display_heatmap</span><span class="p">(</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">pipe</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">):</span>
    <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
        <span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">mean_test_score</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

    <span class="c1"># plot the mean cross-validation scores</span>
    <span class="n">mglearn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
        <span class="n">scores</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;gamma&quot;</span><span class="p">,</span>
        <span class="n">xticklabels</span><span class="o">=</span><span class="n">param_grid</span><span class="p">[</span><span class="s2">&quot;svc__gamma&quot;</span><span class="p">],</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">,</span>
        <span class="n">yticklabels</span><span class="o">=</span><span class="n">param_grid</span><span class="p">[</span><span class="s2">&quot;svc__C&quot;</span><span class="p">],</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
    <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Note that the range we pick for the parameters play an important role in hyperparameter optimization.</p></li>
<li><p>For example, consider the following grid and the corresponding results.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;svc__gamma&quot;</span><span class="p">:</span> <span class="mf">10.0</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> 
    <span class="s2">&quot;svc__C&quot;</span><span class="p">:</span> <span class="mf">10.0</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">display_heatmap</span><span class="p">(</span><span class="n">param_grid1</span><span class="p">,</span> <span class="n">pipe_svm</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/08_hyperparameter-optimization_69_0.png" src="../_images/08_hyperparameter-optimization_69_0.png" />
</div>
</div>
<ul class="simple">
<li><p>Each point in the heat map corresponds to one run of cross-validation, with a particular setting</p></li>
<li><p>Colour encodes cross-validation accuracy.</p>
<ul>
<li><p>Lighter colour means high accuracy</p></li>
<li><p>Darker colour means low accuracy</p></li>
</ul>
</li>
<li><p>SVC is quite sensitive to hyperparameter settings.</p></li>
<li><p>Adjusting hyperparameters can change the accuracy from 0.51 to 0.74!</p></li>
</ul>
</section>
<section id="bad-range-for-hyperparameters">
<h3>Bad range for hyperparameters<a class="headerlink" href="#bad-range-for-hyperparameters" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 10.        ,  15.84893192,  25.11886432,  39.81071706,
        63.09573445, 100.        ])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1. , 1.2, 1.4, 1.6, 1.8, 2. ])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid2</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;svc__gamma&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;svc__C&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)}</span>
<span class="n">display_heatmap</span><span class="p">(</span><span class="n">param_grid2</span><span class="p">,</span> <span class="n">pipe_svm</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/08_hyperparameter-optimization_74_0.png" src="../_images/08_hyperparameter-optimization_74_0.png" />
</div>
</div>
</section>
<section id="different-range-for-hyperparameters-yields-better-results">
<h3>Different range for hyperparameters yields better results!<a class="headerlink" href="#different-range-for-hyperparameters-yields-better-results" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1.e-03, 1.e-02, 1.e-01, 1.e+00, 1.e+01, 1.e+02])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1. , 1.2, 1.4, 1.6, 1.8, 2. ])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid3</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;svc__gamma&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="s2">&quot;svc__C&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)}</span>

<span class="n">display_heatmap</span><span class="p">(</span><span class="n">param_grid3</span><span class="p">,</span> <span class="n">pipe_svm</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/08_hyperparameter-optimization_78_0.png" src="../_images/08_hyperparameter-optimization_78_0.png" />
</div>
</div>
<p>It seems like we are getting even better cross-validation results with <code class="docutils literal notranslate"><span class="pre">C</span></code> = 2.0 and <code class="docutils literal notranslate"><span class="pre">gamma</span></code> = 0.1</p>
<p>How about exploring different values of <code class="docutils literal notranslate"><span class="pre">C</span></code> close to 2.0?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid4</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;svc__gamma&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="s2">&quot;svc__C&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)}</span>

<span class="n">display_heatmap</span><span class="p">(</span><span class="n">param_grid4</span><span class="p">,</span> <span class="n">pipe_svm</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/08_hyperparameter-optimization_80_0.png" src="../_images/08_hyperparameter-optimization_80_0.png" />
</div>
</div>
<p>That’s good! We are finding some more options for <code class="docutils literal notranslate"><span class="pre">C</span></code> where the accuracy is 0.75.
The tricky part is we do not know in advance what range of hyperparameters might work the best for the given problem, model, and the dataset.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> allows the param_grid to be a list of dictionaries. Sometimes some hyperparameters are applicable only for certain models.
For example, in the context of <code class="docutils literal notranslate"><span class="pre">SVC</span></code>, <code class="docutils literal notranslate"><span class="pre">C</span></code> and <code class="docutils literal notranslate"><span class="pre">gamma</span></code> are applicable when the kernel is <code class="docutils literal notranslate"><span class="pre">rbf</span></code> whereas only <code class="docutils literal notranslate"><span class="pre">C</span></code> is applicable for <code class="docutils literal notranslate"><span class="pre">kernel=&quot;linear&quot;</span></code>.</p>
</div>
</section>
<section id="problems-with-exhaustive-grid-search">
<h3>Problems with exhaustive grid search<a class="headerlink" href="#problems-with-exhaustive-grid-search" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Required number of models to evaluate grows exponentially with the dimensionally of the configuration space.</p></li>
<li><p>Example: Suppose you have</p>
<ul>
<li><p>5 hyperparameters</p></li>
<li><p>10 different values for each hyperparameter</p></li>
<li><p>You’ll be evaluating <span class="math notranslate nohighlight">\(10^5=100,000\)</span> models! That is you’ll be calling <code class="docutils literal notranslate"><span class="pre">cross_validate</span></code> 100,000 times!</p></li>
</ul>
</li>
<li><p>Exhaustive search may become infeasible fairly quickly.</p></li>
<li><p>Other options?</p></li>
</ul>
<p><br><br><br><br></p>
</section>
</section>
<section id="randomized-hyperparameter-search">
<h2>Randomized hyperparameter search<a class="headerlink" href="#randomized-hyperparameter-search" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Randomized hyperparameter optimization</p>
<ul>
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.RandomizedSearchCV.html"><code class="docutils literal notranslate"><span class="pre">sklearn.model_selection.RandomizedSearchCV</span></code></a></p></li>
</ul>
</li>
<li><p>Samples configurations at random until certain budget (e.g., time) is exhausted</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">RandomizedSearchCV</span>


<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;svc__gamma&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
    <span class="s2">&quot;svc__C&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
<span class="p">}</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Grid size: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">.</span><span class="n">values</span><span class="p">())))))</span>
<span class="n">param_grid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Grid size: 36
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;svc__gamma&#39;: [0.001, 0.01, 0.1, 1.0, 10, 100],
 &#39;svc__C&#39;: array([2. , 2.2, 2.4, 2.6, 2.8, 3. ])}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">random_search</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span>
    <span class="n">pipe_svm</span><span class="p">,</span> <span class="n">param_distributions</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>
<span class="n">random_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">random_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)[</span>
    <span class="p">[</span>
        <span class="s2">&quot;mean_test_score&quot;</span><span class="p">,</span>
        <span class="s2">&quot;param_svc__gamma&quot;</span><span class="p">,</span>
        <span class="s2">&quot;param_svc__C&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mean_fit_time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rank_test_score&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;rank_test_score&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>rank_test_score</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>7</th>
      <th>9</th>
      <th>10</th>
      <th>11</th>
      <th>12</th>
      <th>13</th>
      <th>13</th>
      <th>13</th>
      <th>16</th>
      <th>16</th>
      <th>16</th>
      <th>16</th>
      <th>16</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mean_test_score</th>
      <td>0.745826</td>
      <td>0.743349</td>
      <td>0.713578</td>
      <td>0.711103</td>
      <td>0.710482</td>
      <td>0.709863</td>
      <td>0.672044</td>
      <td>0.672044</td>
      <td>0.669567</td>
      <td>0.667686</td>
      <td>0.66645</td>
      <td>0.661493</td>
      <td>0.51519</td>
      <td>0.51519</td>
      <td>0.51519</td>
      <td>0.508371</td>
      <td>0.508371</td>
      <td>0.508371</td>
      <td>0.508371</td>
      <td>0.508371</td>
    </tr>
    <tr>
      <th>param_svc__gamma</th>
      <td>0.1</td>
      <td>0.1</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>10</td>
      <td>10</td>
      <td>10</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
    </tr>
    <tr>
      <th>param_svc__C</th>
      <td>2.8</td>
      <td>2.2</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>2.6</td>
      <td>2.4</td>
      <td>2.6</td>
      <td>2.4</td>
      <td>2.2</td>
      <td>3.0</td>
      <td>2.4</td>
      <td>2.0</td>
      <td>2.4</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>2.2</td>
      <td>2.8</td>
      <td>2.4</td>
    </tr>
    <tr>
      <th>mean_fit_time</th>
      <td>0.048797</td>
      <td>0.045134</td>
      <td>0.047344</td>
      <td>0.045852</td>
      <td>0.047109</td>
      <td>0.048143</td>
      <td>0.067462</td>
      <td>0.072968</td>
      <td>0.072266</td>
      <td>0.04867</td>
      <td>0.051096</td>
      <td>0.049022</td>
      <td>0.06846</td>
      <td>0.071682</td>
      <td>0.074351</td>
      <td>0.060394</td>
      <td>0.053117</td>
      <td>0.059718</td>
      <td>0.053198</td>
      <td>0.06012</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="n-iter">
<h3><code class="docutils literal notranslate"><span class="pre">n_iter</span></code><a class="headerlink" href="#n-iter" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Note the <code class="docutils literal notranslate"><span class="pre">n_iter</span></code>, we didn’t need this for <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code>.</p></li>
<li><p>Larger <code class="docutils literal notranslate"><span class="pre">n_iter</span></code> will take longer but it’ll do more searching.</p>
<ul>
<li><p>Remember you still need to multiply by number of folds!</p></li>
</ul>
</li>
<li><p>I have set the <code class="docutils literal notranslate"><span class="pre">random_state</span></code> for reproducibility but you don’t have to do it.</p></li>
</ul>
</section>
<section id="optional-passing-probability-distributions-to-random-search">
<h3>(Optional) Passing probability distributions to random search<a class="headerlink" href="#optional-passing-probability-distributions-to-random-search" title="Permalink to this headline">#</a></h3>
<p>Another thing we can do is give probability distributions to draw from:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">expon</span><span class="p">,</span> <span class="n">lognorm</span><span class="p">,</span> <span class="n">loguniform</span><span class="p">,</span> <span class="n">randint</span><span class="p">,</span> <span class="n">uniform</span><span class="p">,</span> <span class="n">norm</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">uniform</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
<span class="nb">bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>  

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="nb">bin</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/08_hyperparameter-optimization_93_0.png" src="../_images/08_hyperparameter-optimization_93_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>

<span class="c1">#creating bin</span>
<span class="nb">bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>  

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="nb">bin</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/08_hyperparameter-optimization_94_0.png" src="../_images/08_hyperparameter-optimization_94_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">expon</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>

<span class="c1">#creating bin</span>
<span class="nb">bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>  

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="nb">bin</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/08_hyperparameter-optimization_95_0.png" src="../_images/08_hyperparameter-optimization_95_0.png" />
</div>
</div>
<p><br><br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_dist</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;svc__C&quot;</span><span class="p">:</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">),</span>  <span class="c1"># loguniform(1e-3, 1e3),</span>
    <span class="s2">&quot;svc__gamma&quot;</span><span class="p">:</span> <span class="n">loguniform</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">random_search</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span>
    <span class="n">pipe_svm</span><span class="p">,</span> <span class="n">param_dist</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">random_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fitting 5 folds for each of 100 candidates, totalling 500 fits
</pre></div>
</div>
<div class="output text_html"><style>#sk-container-id-4 {color: black;background-color: white;}#sk-container-id-4 pre{padding: 0;}#sk-container-id-4 div.sk-toggleable {background-color: white;}#sk-container-id-4 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-4 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-4 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-4 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-4 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-4 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-4 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-4 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-4 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-4 div.sk-item {position: relative;z-index: 1;}#sk-container-id-4 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-4 div.sk-item::before, #sk-container-id-4 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-4 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-4 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-4 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-4 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-4 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-4 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-4 div.sk-label-container {text-align: center;}#sk-container-id-4 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-4 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-4" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomizedSearchCV(estimator=Pipeline(steps=[(&#x27;standardscaler&#x27;,
                                              StandardScaler()),
                                             (&#x27;svc&#x27;, SVC())]),
                   n_iter=100, n_jobs=-1,
                   param_distributions={&#x27;svc__C&#x27;: &lt;scipy.stats._distn_infrastructure.rv_continuous_frozen object at 0x14ee93a60&gt;,
                                        &#x27;svc__gamma&#x27;: &lt;scipy.stats._distn_infrastructure.rv_continuous_frozen object at 0x14ee913c0&gt;},
                   random_state=123, verbose=1)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox" ><label for="sk-estimator-id-11" class="sk-toggleable__label sk-toggleable__label-arrow">RandomizedSearchCV</label><div class="sk-toggleable__content"><pre>RandomizedSearchCV(estimator=Pipeline(steps=[(&#x27;standardscaler&#x27;,
                                              StandardScaler()),
                                             (&#x27;svc&#x27;, SVC())]),
                   n_iter=100, n_jobs=-1,
                   param_distributions={&#x27;svc__C&#x27;: &lt;scipy.stats._distn_infrastructure.rv_continuous_frozen object at 0x14ee93a60&gt;,
                                        &#x27;svc__gamma&#x27;: &lt;scipy.stats._distn_infrastructure.rv_continuous_frozen object at 0x14ee913c0&gt;},
                   random_state=123, verbose=1)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox" ><label for="sk-estimator-id-12" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()), (&#x27;svc&#x27;, SVC())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-13" type="checkbox" ><label for="sk-estimator-id-13" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-14" type="checkbox" ><label for="sk-estimator-id-14" class="sk-toggleable__label sk-toggleable__label-arrow">SVC</label><div class="sk-toggleable__content"><pre>SVC()</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">random_search</span><span class="o">.</span><span class="n">best_score_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.7383804780493433
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">random_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)[</span>
    <span class="p">[</span>
        <span class="s2">&quot;mean_test_score&quot;</span><span class="p">,</span>
        <span class="s2">&quot;param_svc__gamma&quot;</span><span class="p">,</span>
        <span class="s2">&quot;param_svc__C&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mean_fit_time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rank_test_score&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;rank_test_score&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>rank_test_score</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>9</th>
      <th>...</th>
      <th>82</th>
      <th>82</th>
      <th>82</th>
      <th>82</th>
      <th>82</th>
      <th>96</th>
      <th>96</th>
      <th>96</th>
      <th>96</th>
      <th>96</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mean_test_score</th>
      <td>0.73838</td>
      <td>0.7359</td>
      <td>0.735277</td>
      <td>0.733415</td>
      <td>0.731556</td>
      <td>0.729716</td>
      <td>0.729068</td>
      <td>0.728454</td>
      <td>0.72845</td>
      <td>0.72845</td>
      <td>...</td>
      <td>0.508371</td>
      <td>0.508371</td>
      <td>0.508371</td>
      <td>0.508371</td>
      <td>0.508371</td>
      <td>0.50713</td>
      <td>0.50713</td>
      <td>0.50713</td>
      <td>0.50713</td>
      <td>0.50713</td>
    </tr>
    <tr>
      <th>param_svc__gamma</th>
      <td>0.00271</td>
      <td>0.001946</td>
      <td>0.00283</td>
      <td>0.003148</td>
      <td>0.003834</td>
      <td>0.015524</td>
      <td>0.00067</td>
      <td>0.005593</td>
      <td>0.00089</td>
      <td>0.000458</td>
      <td>...</td>
      <td>33.017913</td>
      <td>51.754341</td>
      <td>126.722678</td>
      <td>84.511472</td>
      <td>120.952433</td>
      <td>766.440217</td>
      <td>739.685456</td>
      <td>918.053216</td>
      <td>263.398099</td>
      <td>806.79529</td>
    </tr>
    <tr>
      <th>param_svc__C</th>
      <td>3427.738338</td>
      <td>6964.791856</td>
      <td>2865.466167</td>
      <td>4258.402903</td>
      <td>7224.533826</td>
      <td>1511.374523</td>
      <td>3617.986556</td>
      <td>2408.658977</td>
      <td>7636.928414</td>
      <td>9053.515757</td>
      <td>...</td>
      <td>5826.810879</td>
      <td>7087.073954</td>
      <td>6648.824488</td>
      <td>6007.085678</td>
      <td>957.225166</td>
      <td>4830.442643</td>
      <td>9019.213727</td>
      <td>7049.688305</td>
      <td>3370.763834</td>
      <td>26.980646</td>
    </tr>
    <tr>
      <th>mean_fit_time</th>
      <td>0.259563</td>
      <td>0.338988</td>
      <td>0.237835</td>
      <td>0.355988</td>
      <td>0.589278</td>
      <td>0.419894</td>
      <td>0.120097</td>
      <td>0.332421</td>
      <td>0.226367</td>
      <td>0.163214</td>
      <td>...</td>
      <td>0.083309</td>
      <td>0.075449</td>
      <td>0.060676</td>
      <td>0.063385</td>
      <td>0.061059</td>
      <td>0.060164</td>
      <td>0.059114</td>
      <td>0.060228</td>
      <td>0.056074</td>
      <td>0.064337</td>
    </tr>
  </tbody>
</table>
<p>4 rows × 100 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>This is a bit fancy. What’s nice is that you can have it concentrate more on certain values by setting the distribution.</p></li>
</ul>
</section>
<section id="advantages-of-randomizedsearchcv">
<h3>Advantages of <code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code><a class="headerlink" href="#advantages-of-randomizedsearchcv" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Faster compared to <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code>.</p></li>
<li><p>Adding parameters that do not influence the performance does not affect efficiency.</p></li>
<li><p>Works better when some parameters are more important than others.</p></li>
<li><p>In general, I recommend using <code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code> rather than <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code>.</p></li>
</ul>
</section>
<section id="id1">
<h3>Advantages of <code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code><a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<p><img alt="" src="../_images/randomsearch_bergstra.png" /></p>
<p>Source: <a class="reference external" href="http://www.jmlr.org/papers/volume13/bergstra12a/bergstra12a.pdf">Bergstra and Bengio, Random Search for Hyper-Parameter Optimization, JMLR 2012</a>.</p>
<ul class="simple">
<li><p>The yellow on the left shows how your scores are going to change when you vary the unimportant hyperparameter.</p></li>
<li><p>The green on the top shows how your scores are  going to change when you vary the important hyperparameter.</p></li>
<li><p>You don’t know in advance which hyperparameters are important for your problem.</p></li>
<li><p>In the left figure, 6 of the 9 searches are useless because they are only varying the unimportant parameter.</p></li>
<li><p>In the right figure, all 9 searches are useful.</p></li>
</ul>
</section>
<section id="searching-for-optimal-parameters-with-successive-halving">
<h3>Searching for optimal parameters with successive halving¶<a class="headerlink" href="#searching-for-optimal-parameters-with-successive-halving" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Successive halving is an iterative selection process where all candidates (the parameter combinations) are evaluated with a small amount of resources (e.g., small amount of training data) at the first iteration.</p></li>
<li><p>Checkout <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.HalvingGridSearchCV.html">successive halving with grid search</a> and <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.HalvingRandomSearchCV.html">random search</a>.</p></li>
</ul>
</section>
</section>
<section id="optional-fancier-methods">
<h2>(Optional) Fancier methods<a class="headerlink" href="#optional-fancier-methods" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Both <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> and <code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code> do each trial independently.</p></li>
<li><p>What if you could learn from your experience, e.g. learn that <code class="docutils literal notranslate"><span class="pre">max_depth=3</span></code> is bad?</p>
<ul>
<li><p>That could save time because you wouldn’t try combinations involving <code class="docutils literal notranslate"><span class="pre">max_depth=3</span></code> in the future.</p></li>
</ul>
</li>
<li><p>We can do this with <code class="docutils literal notranslate"><span class="pre">scikit-optimize</span></code>, which is a completely different package from <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code></p></li>
<li><p>It uses a technique called “model-based optimization” and we’ll specifically use “Bayesian optimization”.</p>
<ul>
<li><p>In short, it uses machine learning to predict what hyperparameters will be good.</p></li>
<li><p>Machine learning on machine learning!</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>This is an active research area and there are sophisticated packages for this.</p></li>
</ul>
<p>Here are some examples</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/hyperopt/hyperopt-sklearn">hyperopt-sklearn</a></p></li>
<li><p><a class="reference external" href="https://github.com/automl/auto-sklearn">auto-sklearn</a></p></li>
<li><p><a class="reference external" href="https://sigopt.com/docs/overview/scikit_learn">SigOptSearchCV</a></p></li>
<li><p><a class="reference external" href="https://github.com/rhiever/tpot">TPOT</a></p></li>
<li><p><a class="reference external" href="https://github.com/hyperopt/hyperopt">hyperopt</a></p></li>
<li><p><a class="reference external" href="https://github.com/zygmuntz/hyperband">hyperband</a></p></li>
<li><p><a class="reference external" href="http://www.cs.ubc.ca/labs/beta/Projects/SMAC/">SMAC</a></p></li>
<li><p><a class="reference external" href="https://github.com/Yelp/MOE">MOE</a></p></li>
<li><p><a class="reference external" href="https://github.com/mwhoffman/pybo">pybo</a></p></li>
<li><p><a class="reference external" href="https://github.com/HIPS/Spearmint">spearmint</a></p></li>
<li><p><a class="reference external" href="https://github.com/rmcantin/bayesopt">BayesOpt</a></p></li>
</ul>
</section>
<section id="questions-for-you">
<h2>❓❓ Questions for you<a class="headerlink" href="#questions-for-you" title="Permalink to this headline">#</a></h2>
<section id="iclicker-exercise-8-1">
<h3>(iClicker) Exercise 8.1<a class="headerlink" href="#iclicker-exercise-8-1" title="Permalink to this headline">#</a></h3>
<p><strong>iClicker cloud join link: https://join.iclicker.com/3DP5H</strong></p>
<p><strong>Select all of the following statements which are TRUE.</strong></p>
<ul class="simple">
<li><p>(A) If you get best results at the edges of your parameter grid, it might be a good idea to adjust the range of values in your parameter grid.</p></li>
<li><p>(B) Grid search is guaranteed to find best hyperparameters values.</p></li>
<li><p>(C) It is possible to get different hyperparameters in different runs of <code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code>.</p></li>
</ul>
</section>
<section id="questions-for-class-discussion-hyperparameter-optimization">
<h3>Questions for class discussion (hyperparameter optimization)<a class="headerlink" href="#questions-for-class-discussion-hyperparameter-optimization" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Suppose you have 10 hyperparameters, each with 4 possible values. If you run <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> with this parameter grid, how many cross-validation experiments will be carried out?</p></li>
<li><p>Suppose you have 10 hyperparameters and each takes 4 values. If you run <code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code> with this parameter grid with <code class="docutils literal notranslate"><span class="pre">n_iter=20</span></code>, how many cross-validation experiments will be carried out?</p></li>
</ul>
<p><br><br><br><br></p>
</section>
</section>
<section id="optimization-bias-overfitting-of-the-validation-set">
<h2>Optimization bias/Overfitting of the validation set<a class="headerlink" href="#optimization-bias-overfitting-of-the-validation-set" title="Permalink to this headline">#</a></h2>
<section id="overfitting-of-the-validation-error">
<h3>Overfitting of the validation error<a class="headerlink" href="#overfitting-of-the-validation-error" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Why do we need to evaluate the model on the test set in the end?</p></li>
<li><p>Why not just use cross-validation on the whole dataset?</p></li>
<li><p>While carrying out hyperparameter optimization, we usually try over many possibilities.</p></li>
<li><p>If our dataset is small and if your validation set is hit too many times, we suffer from <strong>optimization bias</strong> or <strong>overfitting the validation set</strong>.</p></li>
</ul>
</section>
<section id="optimization-bias-of-parameter-learning">
<h3>Optimization bias of parameter learning<a class="headerlink" href="#optimization-bias-of-parameter-learning" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Overfitting of the training error</p></li>
<li><p>An example:</p>
<ul>
<li><p>During training, we could search over tons of different decision trees.</p></li>
<li><p>So we can get “lucky” and find a tree with low training error by chance.</p></li>
</ul>
</li>
</ul>
</section>
<section id="optimization-bias-of-hyper-parameter-learning">
<h3>Optimization bias of hyper-parameter learning<a class="headerlink" href="#optimization-bias-of-hyper-parameter-learning" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Overfitting of the validation error</p></li>
<li><p>An example:</p>
<ul>
<li><p>Here, we might optimize the validation error over 1000 values of <code class="docutils literal notranslate"><span class="pre">max_depth</span></code>.</p></li>
<li><p>One of the 1000 trees might have low validation error by chance.</p></li>
</ul>
</li>
</ul>
</section>
<section id="optional-example-1-optimization-bias">
<h3>(Optional) Example 1: Optimization bias<a class="headerlink" href="#optional-example-1-optimization-bias" title="Permalink to this headline">#</a></h3>
<p>Consider a multiple-choice (a,b,c,d) “test” with 10 questions:</p>
<ul class="simple">
<li><p>If you choose answers randomly, expected grade is 25% (no bias).</p></li>
<li><p>If you fill out two tests randomly and pick the best, expected grade is 33%.</p>
<ul>
<li><p>Optimization bias of ~8%.</p></li>
</ul>
</li>
<li><p>If you take the best among 10 random tests, expected grade is ~47%.</p></li>
<li><p>If you take the best among 100, expected grade is ~62%.</p></li>
<li><p>If you take the best among 1000, expected grade is ~73%.</p></li>
<li><p>If you take the best among 10000, expected grade is ~82%.</p>
<ul>
<li><p>You have so many “chances” that you expect to do well.</p></li>
</ul>
</li>
</ul>
<p><strong>But on new questions the “random choice” accuracy is still 25%.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># (Optional) Code attribution: Rodolfo Lourenzutti</span>
<span class="n">number_tests</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">]</span>
<span class="k">for</span> <span class="n">ntests</span> <span class="ow">in</span> <span class="n">number_tests</span><span class="p">:</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
        <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">ntests</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;The expected grade among the best of </span><span class="si">%d</span><span class="s2"> tests is : </span><span class="si">%0.2f</span><span class="s2">&quot;</span>
        <span class="o">%</span> <span class="p">(</span><span class="n">ntests</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The expected grade among the best of 1 tests is : 0.25
The expected grade among the best of 2 tests is : 0.33
The expected grade among the best of 10 tests is : 0.47
The expected grade among the best of 100 tests is : 0.62
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The expected grade among the best of 1000 tests is : 0.73
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The expected grade among the best of 10000 tests is : 0.83
</pre></div>
</div>
</div>
</div>
</section>
<section id="optional-example-2-optimization-bias">
<h3>(Optional) Example 2: Optimization bias<a class="headerlink" href="#optional-example-2-optimization-bias" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>If we instead used a 100-question test then:</p>
<ul>
<li><p>Expected grade from best over 1 randomly-filled test is 25%.</p></li>
<li><p>Expected grade from best over 2 randomly-filled test is ~27%.</p></li>
<li><p>Expected grade from best over 10 randomly-filled test is ~32%.</p></li>
<li><p>Expected grade from best over 100 randomly-filled test is ~36%.</p></li>
<li><p>Expected grade from best over 1000 randomly-filled test is ~40%.</p></li>
<li><p>Expected grade from best over 10000 randomly-filled test is ~43%.</p></li>
</ul>
</li>
<li><p>The optimization bias <strong>grows with the number of things we try</strong>.</p>
<ul>
<li><p>“Complexity” of the set of models we search over.</p></li>
</ul>
</li>
<li><p>But, optimization bias <strong>shrinks quickly with the number of examples</strong>.</p>
<ul>
<li><p>But it’s still non-zero and growing if you over-use your validation set!</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># (Optional) Code attribution: Rodolfo Lourenzutti</span>
<span class="n">number_tests</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">]</span>
<span class="k">for</span> <span class="n">ntests</span> <span class="ow">in</span> <span class="n">number_tests</span><span class="p">:</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
        <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">ntests</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;The expected grade among the best of </span><span class="si">%d</span><span class="s2"> tests is : </span><span class="si">%0.2f</span><span class="s2">&quot;</span>
        <span class="o">%</span> <span class="p">(</span><span class="n">ntests</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The expected grade among the best of 1 tests is : 0.25
The expected grade among the best of 2 tests is : 0.27
The expected grade among the best of 10 tests is : 0.32
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The expected grade among the best of 100 tests is : 0.36
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The expected grade among the best of 1000 tests is : 0.40
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The expected grade among the best of 10000 tests is : 0.43
</pre></div>
</div>
</div>
</div>
</section>
<section id="optimization-bias-on-the-spotify-dataset">
<h3>Optimization bias on the Spotify dataset<a class="headerlink" href="#optimization-bias-on-the-spotify-dataset" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_tiny</span><span class="p">,</span> <span class="n">X_test_big</span><span class="p">,</span> <span class="n">y_train_tiny</span><span class="p">,</span> <span class="n">y_test_big</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X_spotify</span><span class="p">,</span> <span class="n">y_spotify</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_tiny</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(20, 13)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_tiny</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>acousticness</th>
      <th>danceability</th>
      <th>duration_ms</th>
      <th>energy</th>
      <th>instrumentalness</th>
      <th>key</th>
      <th>liveness</th>
      <th>loudness</th>
      <th>mode</th>
      <th>speechiness</th>
      <th>tempo</th>
      <th>time_signature</th>
      <th>valence</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>130</th>
      <td>0.055100</td>
      <td>0.547</td>
      <td>251093</td>
      <td>0.643</td>
      <td>0.000000</td>
      <td>1</td>
      <td>0.2670</td>
      <td>-8.904</td>
      <td>1</td>
      <td>0.2270</td>
      <td>143.064</td>
      <td>4.0</td>
      <td>0.1870</td>
    </tr>
    <tr>
      <th>1687</th>
      <td>0.000353</td>
      <td>0.420</td>
      <td>210240</td>
      <td>0.929</td>
      <td>0.000747</td>
      <td>7</td>
      <td>0.1220</td>
      <td>-3.899</td>
      <td>0</td>
      <td>0.1210</td>
      <td>127.204</td>
      <td>4.0</td>
      <td>0.3180</td>
    </tr>
    <tr>
      <th>871</th>
      <td>0.314000</td>
      <td>0.430</td>
      <td>193427</td>
      <td>0.734</td>
      <td>0.000286</td>
      <td>9</td>
      <td>0.0808</td>
      <td>-10.043</td>
      <td>0</td>
      <td>0.1020</td>
      <td>133.992</td>
      <td>4.0</td>
      <td>0.0537</td>
    </tr>
    <tr>
      <th>1123</th>
      <td>0.082100</td>
      <td>0.725</td>
      <td>246653</td>
      <td>0.711</td>
      <td>0.000000</td>
      <td>10</td>
      <td>0.0931</td>
      <td>-4.544</td>
      <td>1</td>
      <td>0.0335</td>
      <td>93.003</td>
      <td>4.0</td>
      <td>0.4760</td>
    </tr>
    <tr>
      <th>1396</th>
      <td>0.286000</td>
      <td>0.616</td>
      <td>236960</td>
      <td>0.387</td>
      <td>0.000000</td>
      <td>9</td>
      <td>0.2770</td>
      <td>-6.079</td>
      <td>0</td>
      <td>0.0335</td>
      <td>81.856</td>
      <td>4.0</td>
      <td>0.4700</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">SVC</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">RandomizedSearchCV</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;svc__gamma&quot;</span><span class="p">:</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="s2">&quot;svc__C&quot;</span><span class="p">:</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
<span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Grid size: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">.</span><span class="n">values</span><span class="p">())))))</span>
<span class="n">param_grid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Grid size: 900
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;svc__gamma&#39;: array([1.e-20, 1.e-19, 1.e-18, 1.e-17, 1.e-16, 1.e-15, 1.e-14, 1.e-13,
        1.e-12, 1.e-11, 1.e-10, 1.e-09, 1.e-08, 1.e-07, 1.e-06, 1.e-05,
        1.e-04, 1.e-03, 1.e-02, 1.e-01, 1.e+00, 1.e+01, 1.e+02, 1.e+03,
        1.e+04, 1.e+05, 1.e+06, 1.e+07, 1.e+08, 1.e+09]),
 &#39;svc__C&#39;: array([1.e-20, 1.e-19, 1.e-18, 1.e-17, 1.e-16, 1.e-15, 1.e-14, 1.e-13,
        1.e-12, 1.e-11, 1.e-10, 1.e-09, 1.e-08, 1.e-07, 1.e-06, 1.e-05,
        1.e-04, 1.e-03, 1.e-02, 1.e-01, 1.e+00, 1.e+01, 1.e+02, 1.e+03,
        1.e+04, 1.e+05, 1.e+06, 1.e+07, 1.e+08, 1.e+09])}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">random_search</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span>
    <span class="n">pipe</span><span class="p">,</span> <span class="n">param_distributions</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span>
<span class="p">)</span>
<span class="n">random_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_tiny</span><span class="p">,</span> <span class="n">y_train_tiny</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">random_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)[</span>
    <span class="p">[</span>
        <span class="s2">&quot;mean_test_score&quot;</span><span class="p">,</span>
        <span class="s2">&quot;param_svc__gamma&quot;</span><span class="p">,</span>
        <span class="s2">&quot;param_svc__C&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mean_fit_time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rank_test_score&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;rank_test_score&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>rank_test_score</th>
      <th>1</th>
      <th>1</th>
      <th>3</th>
      <th>3</th>
      <th>3</th>
      <th>3</th>
      <th>3</th>
      <th>3</th>
      <th>3</th>
      <th>3</th>
      <th>...</th>
      <th>20</th>
      <th>20</th>
      <th>20</th>
      <th>20</th>
      <th>20</th>
      <th>20</th>
      <th>20</th>
      <th>20</th>
      <th>20</th>
      <th>900</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mean_test_score</th>
      <td>0.8</td>
      <td>0.8</td>
      <td>0.75</td>
      <td>0.75</td>
      <td>0.75</td>
      <td>0.75</td>
      <td>0.75</td>
      <td>0.75</td>
      <td>0.75</td>
      <td>0.75</td>
      <td>...</td>
      <td>0.65</td>
      <td>0.65</td>
      <td>0.65</td>
      <td>0.65</td>
      <td>0.65</td>
      <td>0.65</td>
      <td>0.65</td>
      <td>0.65</td>
      <td>0.65</td>
      <td>0.55</td>
    </tr>
    <tr>
      <th>param_svc__gamma</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0.0</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>100000.0</td>
      <td>1000000000.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>param_svc__C</th>
      <td>1000000000.0</td>
      <td>100000000.0</td>
      <td>1000000000.0</td>
      <td>10000.0</td>
      <td>1000000.0</td>
      <td>10000000.0</td>
      <td>100000.0</td>
      <td>1000.0</td>
      <td>10000000.0</td>
      <td>100000000.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1000000000.0</td>
      <td>1000000000.0</td>
    </tr>
    <tr>
      <th>mean_fit_time</th>
      <td>0.001782</td>
      <td>0.001374</td>
      <td>0.000977</td>
      <td>0.001886</td>
      <td>0.001871</td>
      <td>0.001475</td>
      <td>0.000964</td>
      <td>0.001768</td>
      <td>0.000983</td>
      <td>0.001815</td>
      <td>...</td>
      <td>0.001021</td>
      <td>0.000961</td>
      <td>0.002839</td>
      <td>0.001282</td>
      <td>0.00181</td>
      <td>0.001313</td>
      <td>0.000963</td>
      <td>0.002215</td>
      <td>0.001415</td>
      <td>0.001016</td>
    </tr>
  </tbody>
</table>
<p>4 rows × 900 columns</p>
</div></div></div>
</div>
<p>Given the results: one might claim that we found a model that performs with 0.8 accuracy on our dataset.</p>
<ul class="simple">
<li><p>Do we really believe that 0.80 is a good estimate of our test data?</p></li>
<li><p>Do we really believe that <code class="docutils literal notranslate"><span class="pre">gamma</span></code>=0.0 and C=1_000_000_000 are the best hyperparameters?</p></li>
</ul>
<ul class="simple">
<li><p>Let’s find out the test score with this best model.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">random_search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6163366336633663
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>The results above are overly optimistic.</p>
<ul>
<li><p>because our training data is very small and so our validation splits in cross validation would be small.</p></li>
<li><p>because of the small dataset and the fact that we hit the small validation set 900 times and it’s possible that we got lucky on the validation set!</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>As we suspected, the best cross-validation score is not a good estimate of our test data; it is overly optimistic.</p></li>
<li><p>We can trust this test score because the test set is of good size.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_test_big</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1997, 13)
</pre></div>
</div>
</div>
</div>
</section>
<section id="overfitting-of-the-validation-data">
<h3>Overfitting of the validation data<a class="headerlink" href="#overfitting-of-the-validation-data" title="Permalink to this headline">#</a></h3>
<p>The following plot demonstrates what happens during overfitting of the validation data.</p>
<center>
<img src='./img/optimization-bias.png' width="600">
</center>
<p><a class="reference external" href="https://amueller.github.io/COMS4995-s20/slides/aml-03-supervised-learning/#20">Source</a></p>
<ul class="simple">
<li><p>Thus, not only can we not trust the cv scores, we also cannot trust cv’s ability to choose of the best hyperparameters.</p></li>
</ul>
</section>
<section id="why-do-we-need-a-test-set">
<h3>Why do we need a test set?<a class="headerlink" href="#why-do-we-need-a-test-set" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>This is why we need a test set.</p></li>
<li><p>The frustrating part is that if our dataset is small then our test set is also small 😔.</p></li>
<li><p>But we don’t have a lot of better alternatives, unfortunately, if we have a small dataset.</p></li>
</ul>
</section>
<section id="when-test-score-is-much-lower-than-cv-score">
<h3>When test score is much lower than CV score<a class="headerlink" href="#when-test-score-is-much-lower-than-cv-score" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>What to do if your test score is much lower than your cross-validation score:</p>
<ul>
<li><p>Try simpler models and use the test set a couple of times; it’s not the end of the world.</p></li>
<li><p>Communicate this clearly when you report the results.</p></li>
</ul>
</li>
</ul>
</section>
<section id="large-datasets-solve-many-of-these-problems">
<h3>Large datasets solve many of these problems<a class="headerlink" href="#large-datasets-solve-many-of-these-problems" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>With infinite amounts of training data, overfitting would not be a problem and you could have your test score = your train score.</p>
<ul>
<li><p>Overfitting happens because you only see a bit of data and you learn patterns that are overly specific to your sample.</p></li>
<li><p>If you saw “all” the data, then the notion of “overly specific” would not apply.</p></li>
</ul>
</li>
<li><p>So, more data will make your test score better and robust.</p></li>
</ul>
</section>
</section>
<section id="id2">
<h2>❓❓ Questions for you<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h2>
<p>Attribution: From Mark Schmidt’s notes</p>
<section id="would-you-trust-the-model">
<h3>Would you trust the model?<a class="headerlink" href="#would-you-trust-the-model" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>You have a dataset and you give me half of it. I build a model using all the data you have given me and I tell you that the model accuracy is 0.99. Would it classify the rest of the data with similar accuracy?</p></li>
</ul>
<ol class="simple">
<li><p>Probably</p></li>
<li><p>Probably not</p></li>
</ol>
</section>
<section id="id3">
<h3>Would you trust the model?<a class="headerlink" href="#id3" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>You have a dataset and you give me half of it. I build a model using 80% of the data given to me and report the accuracy of 0.95 on the remaining 20% of the data. Would it classify the rest of the data with similar accuracy?</p></li>
</ul>
<ol class="simple">
<li><p>Probably</p></li>
<li><p>Probably not</p></li>
</ol>
</section>
<section id="id4">
<h3>Would you trust the model?<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>You have a dataset and you give me 1/10th of it. The dataset given to me is rather small and so I split it into 96% train and 4% validation split. I carry out hyperparameter optimization using a single 4% validation split and report validation accuracy of 0.97. Would it classify the rest of the data with similar accuracy?</p></li>
</ul>
<ol class="simple">
<li><p>Probably</p></li>
<li><p>Probably not</p></li>
</ol>
</section>
</section>
<section id="final-comments-and-summary">
<h2>Final comments and summary<a class="headerlink" href="#final-comments-and-summary" title="Permalink to this headline">#</a></h2>
<section id="id5">
<h3>Automated hyperparameter optimization<a class="headerlink" href="#id5" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Advantages</p>
<ul>
<li><p>reduce human effort</p></li>
<li><p>less prone to error and improve reproducibility</p></li>
<li><p>data-driven approaches may be effective</p></li>
</ul>
</li>
<li><p>Disadvantages</p>
<ul>
<li><p>may be hard to incorporate intuition</p></li>
<li><p>be careful about overfitting on the validation set</p></li>
</ul>
</li>
</ul>
<p>Often, especially on typical datasets, we get back <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s default hyperparameter values. This means that the defaults are well chosen by <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> developers!</p>
<ul class="simple">
<li><p>The problem of finding the best values for the important hyperparameters is tricky because</p>
<ul>
<li><p>You may have a lot of them (e.g. deep learning).</p></li>
<li><p>You may have multiple hyperparameters which may interact with each other in unexpected ways.</p></li>
</ul>
</li>
<li><p>The best settings depend on the specific data/problem.</p></li>
</ul>
</section>
</section>
<section id="optional-readings-and-resources">
<h2>Optional readings and resources<a class="headerlink" href="#optional-readings-and-resources" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="http://www.robotics.stanford.edu/~ang/papers/cv-final.pdf">Preventing “overfitting” of cross-validation data</a> by Andrew Ng</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-cpsc330-py"
        },
        kernelOptions: {
            kernelName: "conda-env-cpsc330-py",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-cpsc330-py'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="07_linear-models.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Lecture 7: Linear Models</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="09_classification-metrics.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lecture 9: Classification Metrics</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Varada Kolhatkar<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>